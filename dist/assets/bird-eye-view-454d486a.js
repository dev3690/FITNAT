import{r as l,g as H,j as t,u as le}from"./index-2d6c48e3.js";import{S as M,c as O,u as ie,e as re,f as G,i as oe,U as de}from"./api_utils-656155e4.js";import{g as ce,c as V}from"./date_time-0f4139e7.js";import{c as pe,d as b,T as he,a as ge,e as xe}from"./TableRow-23633447.js";import{B as k}from"./Button-3092075b.js";import{a as ue,U as fe,b as be,T as ke,e as ye,c as je,g as Se}from"./utils-4dd221fb.js";import{C as De}from"./Container-c59ba4a5.js";import{G as Pe}from"./Grid-42780999.js";import{C as Te}from"./Card-218b0185.js";import{T as Ee,D as ve,a as we,b as We,c as _e}from"./TablePagination-4c7f7b96.js";import{T as _}from"./TextField-011572bc.js";import"./TableSortLabel-275bc106.js";import"./MenuItem-18118782.js";import"./Menu-3d17eea1.js";import"./InputAdornment-51c39ccf.js";import"./FormGroup-3ff2807d.js";function $e({selected:y,name:T,id:p,pack:j,pain:B,row:J,selectedColumns:s,url:z,totalWeeks:h,status:o,index:S,start_date:$,end_date:m,handleClick:I,upliftState:a,handleEdit:F,handleDelete:R}){l.useState(null);const[c,E]=l.useState(-1),[N,C]=l.useState(!1),[A,g]=l.useState();l.useEffect(()=>{var d;let n=(d=H("data"))==null?void 0:d.type_id;g(n)});const D=async n=>{console.log("data to update",n);const d=await O(ie,n);a(),console.log("<><><><><><>",d)};return l.useEffect(()=>{let{isNotify:n,currWeek:d}=ce(new Date($).toLocaleString().split(",")[0],new Date(m).toLocaleString().split(",")[0]);E(d),C(n),console.log("WEEK range",{isNotify:n,currWeek:d})},[]),t.jsxs(pe,{hover:!0,tabIndex:-1,children:[(s==null?void 0:s.includes("Name"))&&t.jsx(b,{children:T}),(s==null?void 0:s.includes("Package"))&&t.jsx(b,{children:j==1?"Fitnat Coaching Premium":j==2?"Fitnat Coaching Delux":"Fitnat Personal Training"}),(s==null?void 0:s.includes("Link"))&&t.jsx(b,{align:"center",children:t.jsx(k,{variant:"outlined",href:z,size:"small",color:"success",children:"link"})}),(s==null?void 0:s.includes("Start Date"))&&t.jsx(b,{align:"center",children:new Date($).toLocaleString().split(",")[0]}),(s==null?void 0:s.includes("End Date"))&&t.jsx(b,{align:"center",children:new Date(m).toLocaleString().split(",")[0]}),(s==null?void 0:s.includes("Pain"))&&t.jsx(b,{children:B}),Array.from({length:12},(n,d)=>d).map(n=>s.includes(`Week ${n+1}`)&&t.jsxs(b,{id:`index${n}`,align:"center",sx:{backgroundColor:N&&n+1==c?"#76bfff":n+1==c&&"#e4eaec",borderRadius:n+1==c&&"20px 0px 20px 0px"},children:[t.jsx(k,{variant:"contained",size:"small",color:o[`week${n+1}u1`]==1?"success":o[`week${n+1}u1`]==0&&n+1<c?"info":"error",disabled:n+1>h,onClick:()=>D({id:p,table:M,[`week${n+1}u1`]:o[`week${n+1}u1`]==1?0:1}),children:A==1?"UPD":"UPD1"}),t.jsx(k,{variant:"contained",size:"small",sx:{margin:"10px"},color:o[`week${n+1}u2`]==1?"success":o[`week${n+1}u1`]==0&&n+1<c?"info":"error",disabled:n+1>h,onClick:()=>D({id:p,table:M,[`week${n+1}u2`]:o[`week${n+1}u2`]==1?0:1}),children:A==1?"TKS":"UPD2"}),A==2&&t.jsx(k,{variant:"contained",size:"small",sx:{margin:"10px"},color:o[`week${n+1}u3`]==1?"success":o[`week${n+1}u1`]==0&&n+1<c?"info":"error",disabled:n+1>h,onClick:()=>D({id:p,table:M,[`week${n+1}u3`]:o[`week${n+1}u3`]==1?0:1}),children:"UPD3"})]}))]})}function He(){const[y,T]=l.useState([]),[p,j]=l.useState(0),[B,J]=l.useState("asc"),[s,z]=l.useState("name"),[h,o]=l.useState(""),[S,$]=l.useState(15),[m,I]=l.useState(!1),[a,F]=l.useState(null),[R,c]=l.useState(!1),[E,N]=l.useState(!1),[C,A]=l.useState(!0);let g=[{id:1,label:"Name"},{id:2,label:"Package"},{id:3,label:"Link"},{id:4,label:"Start Date"},{id:5,label:"End Date"},{id:6,label:"Pain"},...Array.from({length:12},(e,r)=>`Week ${r+1}`).map((e,r)=>({id:`${e}-${r}`,label:e}))];const[D,n]=l.useState(g==null?void 0:g.map(e=>e==null?void 0:e.label));l.useEffect(()=>{const e=async()=>{var u,f;try{let x=H("data");const P=await O(re),q=(f=(u=P==null?void 0:P.data)==null?void 0:u.filter(i=>{var w,W;return((W=(w=i==null?void 0:i.patient_master)==null?void 0:w.user_master)==null?void 0:W.type_id)==(x==null?void 0:x.type_id)}))==null?void 0:f.map(i=>{var w,W;return{...i==null?void 0:i.patient_master,id:i==null?void 0:i.id,totalWeeks:(w=V(i==null?void 0:i.patient_master))==null?void 0:w.totalWeeks,currentWeek:(W=V(i==null?void 0:i.patient_master))==null?void 0:W.currentWeek,status:r(i)}});console.log("RESP>>>>>",P==null?void 0:P.data,q),T(q)}catch(x){console.error("Failed to fetch users:",x)}},r=u=>Object.keys(u).filter(f=>f.startsWith("week")).reduce((f,x)=>(f[x]=u[x],f),{});e()},[R]);const d=e=>{F(e),N(!0),I(!0)},Q=async e=>{try{await G.delete(`http://localhost:3690/user_masters/${e}`),T(y.filter(r=>r.id!==e))}catch(r){console.error("Failed to delete user:",r)}},L=()=>{I(!1),N(!1)},X=async()=>{if(E)try{await G.put(`http://localhost:3690/user_masters/${a.id}`,a),T(y.map(e=>e.id===a.id?a:e))}catch(e){console.error("Failed to update user:",e)}else try{if(!(a!=null&&a.name)||!(a!=null&&a.mobile)||!(a!=null&&a.username)||!(a!=null&&a.password)||!(a!=null&&a.type_id)){alert("All fields are required");return}const e=await O(oe,{...a,table:de});console.log("insert RESP",e),c(!R)}catch(e){console.error("Failed to add user:",e)}L()},Y=()=>{c(!R)},Z=(e,r)=>{j(r)},U=e=>{j(0),$(parseInt(e.target.value,10))},ee=e=>{j(0),o(e.target.value)},v=e=>{const{name:r,value:u}=e.target;F({...a,[r]:u})},K=ue({inputData:y,comparator:Se(B,s),filterName:h}),ae=()=>{window.close(),te("/")},te=le(),ne=e=>{console.log(">>>>>>>>",e),n(e)},se=!K.length&&!!h;return t.jsxs(De,{sx:{display:"flex"},children:[t.jsxs(Pe,{xs:12,md:2,margin:5,children:[t.jsx("div",{children:t.jsx(k,{onClick:ae,variant:"contained",color:"primary",children:"Exit"})}),t.jsxs(Te,{sx:{marginTop:"10px"},children:[t.jsx(fe,{numSelected:0,filterName:h,handleSelectedColumns:ne,onFilterName:ee,showFilterButton:C}),t.jsx(he,{sx:{overflow:"auto"},children:t.jsxs(ge,{sx:{minWidth:800},children:[t.jsx(be,{headLabel:g==null?void 0:g.filter(e=>D.includes(e==null?void 0:e.label))}),t.jsxs(xe,{children:[K.slice(p*S,p*S+S).map((e,r)=>t.jsx($e,{selectedColumns:D,id:e.id,index:r,currentWeek:e==null?void 0:e.currentWeek,totalWeeks:e==null?void 0:e.totalWeeks,selected:!1,name:e.name,upliftState:Y,status:e==null?void 0:e.status,pack:e.package,url:e.url,pain:e.pain,start_date:e.start_date,end_date:e.end_date,type_id:e.type_id,handleClick:()=>{},handleEdit:()=>d(e),handleDelete:()=>Q(e.id)})),t.jsx(ke,{height:77,emptyRows:ye(p,S,y.length)}),se&&t.jsx(je,{query:h})]})]})}),t.jsx(Ee,{page:p,component:"div",count:y.length,rowsPerPage:S,onPageChange:Z,rowsPerPageOptions:[15,25,50],onRowsPerPageChange:U})]})]}),t.jsxs(ve,{open:m,onClose:L,children:[t.jsx(we,{children:E?"Edit User":"Add New User"}),t.jsxs(We,{children:[t.jsx(_,{margin:"dense",name:"name",label:"Name",type:"text",fullWidth:!0,value:(a==null?void 0:a.name)||"",onChange:v}),t.jsx(_,{margin:"dense",name:"mobile",label:"Mobile",type:"text",fullWidth:!0,value:(a==null?void 0:a.mobile)||"",onChange:v}),t.jsx(_,{margin:"dense",name:"username",label:"Username",type:"text",fullWidth:!0,value:(a==null?void 0:a.username)||"",onChange:v}),t.jsx(_,{margin:"dense",name:"password",label:"Password",type:"text",fullWidth:!0,value:(a==null?void 0:a.password)||"",onChange:v}),t.jsxs("label",{children:[t.jsx("input",{name:"isMaster",type:"checkbox",checked:(a==null?void 0:a.isMaster)||!1,onChange:e=>F({...a,isMaster:e.target.checked})}),"IsMaster"]}),t.jsx(_,{margin:"dense",name:"type_id",label:"Type ID",type:"number",fullWidth:!0,value:(a==null?void 0:a.type_id)||"",onChange:v})]}),t.jsxs(_e,{children:[t.jsx(k,{onClick:L,children:"Cancel"}),t.jsx(k,{onClick:X,children:E?"Save":"Add"})]})]})]})}export{He as default};
